{
  "permissions": {
    "allow": [
      "Bash(cargo check:*)",
      "Bash(git add:*)",
      "Bash(git commit -m \"$\\(cat <<''EOF''\nFix fork resolution infinite loop by syncing blocks after rollback\n\nThe critical bug was that after finding a fork at genesis and rolling back,\nthe code would refuse to sync from the same peer, returning an error instead.\nThis caused an infinite loop where:\n\n1. Node detects fork at genesis with peer A\n2. Rolls back to genesis \\(height 0\\)\n3. Refuses to sync from peer A\n4. Sync coordinator picks peer B\n5. Detects fork at genesis with peer B\n6. Rolls back to genesis again\n7. Refuses to sync from peer B\n8. Loop repeats forever\n\nFix: After rolling back to common ancestor, check if peer has blocks we need.\nIf yes, immediately request those blocks and wait for them to arrive before\ncompleting the sync. This allows nodes to successfully sync to the longest\nchain even when the fork starts at genesis.\n\nChanges:\n- After rollback, explicitly request blocks from \\(rolled_back_height+1\\) to peer_height\n- Wait for blocks to arrive with proper timeout handling\n- Only mark sync complete after blocks are received or timeout\n- Remove the blanket refusal to sync from the same peer after rollback\n\nResult: Nodes can now properly resolve forks at genesis and sync to the\nlongest valid chain.\n\nCo-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(cargo fmt:*)",
      "Bash(cargo clippy:*)"
    ]
  }
}
